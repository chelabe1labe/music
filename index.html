<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Music With Vibe</title>
<style>
  /* Basic Reset and fonts */
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Poppins', sans-serif;
    margin: 0; padding: 0;
    background: #fff;
    color: #222;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  a {
    color: #B30000;
    text-decoration: none;
  }
  a:hover, a:focus {
    text-decoration: underline;
  }

  header {
    background: #fff;
    box-shadow: 0 2px 6px rgba(179,0,0,0.15);
  }
  nav ul {
    list-style: none;
    display: flex;
    padding: 0.75rem 1rem;
    margin: 0;
    justify-content: center;
    flex-wrap: wrap;
  }
  nav li {
    margin: 0 1rem;
  }
  .nav-btn {
    font-weight: 600;
    font-size: 1rem;
    background: none;
    border: none;
    cursor: pointer;
    color: #B30000;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    transition: background-color 0.3s ease;
  }
  .nav-btn:hover, .nav-btn:focus {
    background-color: #fceaea;
    outline: none;
  }
  .nav-btn.active {
    background-color: #B30000;
    color: white;
    cursor: default;
  }

  main {
    flex-grow: 1;
    max-width: 900px;
    margin: 1rem auto 2rem;
    padding: 0 1rem;
  }

  footer {
    background: #fafafa;
    text-align: center;
    padding: 1rem;
    font-size: 0.9rem;
    color: #555;
    border-top: 1px solid #ddd;
  }

  /* --- Home page --- */
  #home-page h2 {
    color: #B30000;
    margin-top: 1rem;
  }
  .track-list {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }
  .track-tile {
    flex: 1 1 calc(33% - 1rem);
    background: #fff;
    border: 1px solid #eee;
    border-radius: 12px;
    box-shadow: 0 3px 6px rgba(179,0,0,0.1);
    cursor: pointer;
    user-select: none;
    transition: transform 0.2s ease;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .track-tile:hover, .track-tile:focus {
    transform: translateY(-6px);
    outline: none;
    box-shadow: 0 6px 12px rgba(179,0,0,0.3);
  }
  .track-tile img {
    width: 100%;
    height: 140px;
    object-fit: cover;
    border-bottom: 1px solid #eee;
  }
  .track-tile .track-info {
    padding: 0.5rem 0.75rem;
    flex-grow: 1;
  }
  .track-tile .track-info strong {
    color: #B30000;
    font-weight: 600;
  }
  .track-tile .track-info em {
    color: #555;
    font-style: normal;
  }
  .track-badge-license {
    background-color: #B30000;
    color: white;
    font-size: 0.7rem;
    padding: 2px 6px;
    border-radius: 6px;
    position: absolute;
    top: 8px;
    right: 8px;
  }

  /* --- Search page --- */
  #search-page form {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-bottom: 1rem;
    justify-content: center;
  }
  #search-page input[type="text"],
  #search-page select {
    border-radius: 30px;
    border: 2px solid #B30000;
    padding: 10px 16px;
    font-size: 1rem;
    outline-offset: 2px;
  }
  #search-page input[type="text"] {
    flex-grow: 2;
  }
  #search-page select {
    flex-grow: 1;
    min-width: 120px;
    appearance: none;
    background: white url('data:image/svg+xml;charset=US-ASCII,<svg fill="%23B30000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 12px center/1em 1em;
    cursor: pointer;
  }
  #search-page button {
    background: #B30000;
    border: none;
    color: white;
    font-weight: 600;
    cursor: pointer;
    border-radius: 30px;
    padding: 10px 24px;
    flex-grow: 1;
    min-width: 140px;
    transition: background 0.3s ease;
  }
  #search-page button:hover {
    background: #800000;
  }
  #search-page .track-list {
    margin-top: 1rem;
  }

  /* --- Track modal --- */
  #track-modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 999;
    padding: 1rem;
  }
  #track-modal.active {
    display: flex;
  }
  #track-modal .modal-content {
    background: white;
    border-radius: 12px;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    padding: 1rem 1.5rem 2rem;
    position: relative;
  }
  #track-modal button.close-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    border: none;
    background: transparent;
    font-size: 1.5rem;
    font-weight: 700;
    cursor: pointer;
    color: #B30000;
  }
  #track-modal img.album-art {
    max-width: 100%;
    border-radius: 12px;
    margin-bottom: 1rem;
  }
  #track-modal .metadata {
    margin-bottom: 1rem;
  }
  #track-modal .metadata p {
    margin: 0.3rem 0;
  }
  #track-modal .license-link {
    color: #B30000;
    font-weight: 600;
  }
  #track-modal audio {
    width: 100%;
    margin-bottom: 1rem;
  }
  #track-modal .btn-download {
    display: inline-block;
    background: #B30000;
    color: white;
    padding: 12px 24px;
    border-radius: 30px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    user-select: none;
  }
  #track-modal .btn-download:hover {
    background: #800000;
  }
  #track-modal .attribution {
    font-size: 0.9rem;
    color: #555;
    margin-top: 1rem;
    font-style: italic;
  }

  /* --- Favorites page --- */
  #favorites-page .empty-msg {
    text-align: center;
    margin-top: 2rem;
    font-size: 1.2rem;
    color: #999;
  }
  #favorites-page .track-list {
    margin-top: 1rem;
  }

  /* --- Contact & About pages --- */
  #about-page, #contact-page {
    max-width: 600px;
    margin: 0 auto;
  }
  #about-page h2, #contact-page h2 {
    color: #B30000;
  }
  #contact-page p, #about-page p {
    line-height: 1.5;
  }
  #contact-page a {
    word-break: break-word;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .track-tile {
      flex: 1 1 calc(50% - 1rem);
    }
    #search-page form {
      flex-direction: column;
    }
    #search-page input[type="text"],
    #search-page select,
    #search-page button {
      flex-grow: 1;
      width: 100%;
    }
  }
  @media (max-width: 480px) {
    .track-tile {
      flex: 1 1 100%;
    }
  }
</style>
</head>
<body>

<header>
  <nav aria-label="Primary navigation">
    <ul>
      <li><button id="nav-home" class="nav-btn active" aria-current="page">Home</button></li>
      <li><button id="nav-search" class="nav-btn">Search</button></li>
      <li><button id="nav-favorites" class="nav-btn">Favorites</button></li>
      <li><button id="nav-about" class="nav-btn">About</button></li>
      <li><button id="nav-contact" class="nav-btn">Contact</button></li>
    </ul>
  </nav>
</header>

<main id="main-content" tabindex="-1" aria-live="polite">
  <!-- Content rendered here -->
</main>

<footer>
  <p>All downloadable content on Music With Vibe is free to download and use according to its listed license. If you believe a track is incorrectly labeled, please report it.</p>
  <p>Contact: <a href="mailto:mohamedamineelbachiri2005@gmail.com">mohamedamineelbachiri2005@gmail.com</a></p>
  <p>Instagram: <a href="https://www.instagram.com/p_______goodguy?igsh=MWFxY2kxNDlqd2R5Mg==" target="_blank" rel="noopener noreferrer">@p_______goodguy</a></p>
</footer>

<!-- Track Modal -->
<div id="track-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc" tabindex="-1">
  <div class="modal-content">
    <button class="close-btn" aria-label="Close">&times;</button>
    <img src="" alt="" class="album-art" />
    <div class="metadata">
      <h2 id="modal-title"></h2>
      <p><strong>Artist:</strong> <span id="modal-artist"></span></p>
      <p><strong>Album/Collection:</strong> <span id="modal-album"></span></p>
      <p><strong>Release Date:</strong> <span id="modal-release"></span></p>
      <p><strong>Duration:</strong> <span id="modal-duration"></span></p>
      <p><strong>Bitrate:</strong> <span id="modal-bitrate"></span></p>
      <p><strong>License:</strong> <a href="#" id="modal-license" target="_blank" class="license-link" rel="noopener noreferrer">View License</a></p>
    </div>
    <audio controls id="modal-audio"></audio>
    <button class="btn-download" id="modal-download-btn" aria-label="Download track">Download (Free & Legal)</button>
    <p class="attribution" id="modal-attribution"></p>
  </div>
</div>

<script>
  // CLIENT_ID for Jamendo API
  const CLIENT_ID = 'a37c3d7f'; // Your actual Jamendo API client ID

  const mainContent = document.getElementById('main-content');
  const navButtons = document.querySelectorAll('.nav-btn');
  const trackModal = document.getElementById('track-modal');
  const modalCloseBtn = trackModal.querySelector('.close-btn');

  // Modal elements
  const modalTitle = document.getElementById('modal-title');
  const modalArtist = document.getElementById('modal-artist');
  const modalAlbum = document.getElementById('modal-album');
  const modalRelease = document.getElementById('modal-release');
  const modalDuration = document.getElementById('modal-duration');
  const modalBitrate = document.getElementById('modal-bitrate');
  const modalLicense = document.getElementById('modal-license');
  const modalAudio = document.getElementById('modal-audio');
  const modalDownloadBtn = document.getElementById('modal-download-btn');
  const modalAttribution = document.getElementById('modal-attribution');

  // Store favorites in localStorage
  function getFavorites() {
    const fav = localStorage.getItem('mwb-favorites');
    return fav ? JSON.parse(fav) : [];
  }
  function saveFavorites(favs) {
    localStorage.setItem('mwb-favorites', JSON.stringify(favs));
  }
  function isFavorite(trackId) {
    return getFavorites().some(t => t.id === trackId);
  }
  function toggleFavorite(track) {
    let favs = getFavorites();
    if(isFavorite(track.id)) {
      favs = favs.filter(t => t.id !== track.id);
    } else {
      favs.push(track);
    }
    saveFavorites(favs);
  }

  // Navigation page loader
  function setActiveNav(buttonId) {
    navButtons.forEach(btn => {
      btn.classList.toggle('active', btn.id === buttonId);
      if(btn.id === buttonId) btn.setAttribute('aria-current', 'page');
      else btn.removeAttribute('aria-current');
    });
  }

  function renderHome() {
    setActiveNav('nav-home');
    mainContent.innerHTML = `
      <h2>Trending Free Tracks</h2>
      <div id="trending" class="track-list" tabindex="0"></div>

      <h2>Editor's Picks</h2>
      <div id="editors" class="track-list" tabindex="0"></div>

      <h2>New Uploads</h2>
      <div id="newuploads" class="track-list" tabindex="0"></div>
    `;
    mainContent.focus();

    // Fetch or mock data for these sections
    // Using Jamendo API to fetch with tags or popularity

    fetchSectionTracks('pop,rock', 'trending');
    fetchSectionTracks('jazz,blues', 'editors');
    fetchSectionTracks('', 'newuploads', 10, 'date_desc');
  }

  async function fetchSectionTracks(tags = '', containerId, limit=6, order='popularity_total') {
    try {
      const url = `https://api.jamendo.com/v3.0/tracks/?client_id=${CLIENT_ID}&format=jsonpretty&limit=${limit}&order=${order}&include=musicinfo+stats+license&tags=${encodeURIComponent(tags)}`;
      const res = await fetch(url);
      const data = await res.json();
      if(data && data.results) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        data.results.forEach(track => {
          const tile = createTrackTile(track);
          container.appendChild(tile);
        });
      }
    } catch(err) {
      console.error('Error fetching section tracks:', err);
    }
  }

  function createTrackTile(track) {
    const tile = document.createElement('div');
    tile.className = 'track-tile';
    tile.tabIndex = 0;
    tile.setAttribute('role', 'button');
    tile.setAttribute('aria-label', `${track.name} by ${track.artist_name}, click for details`);
    tile.innerHTML = `
      <div style="position:relative;">
        <img src="${track.album_image}" alt="Album art for ${track.name}" />
        <span class="track-badge-license" title="License: ${track.license_name}">${track.license_name}</span>
      </div>
      <div class="track-info">
        <strong>${track.name}</strong><br/>
        <em>${track.artist_name}</em>
      </div>
    `;
    tile.addEventListener('click', () => openTrackModal(track));
    tile.addEventListener('keypress', (e) => { if(e.key === 'Enter' || e.key === ' ') openTrackModal(track); });
    return tile;
  }

  function openTrackModal(track) {
    modalTitle.textContent = track.name;
    modalArtist.textContent = track.artist_name;
    modalAlbum.textContent = track.album_name || 'N/A';
    modalRelease.textContent = track.releasedate || 'N/A';
    modalDuration.textContent = secondsToTime(track.duration);
    modalBitrate.textContent = track.audio_summary ? `${track.audio_summary.bitrate} kbps` : 'N/A';
    modalLicense.textContent = track.license_name;
    modalLicense.href = track.license_ccurl || '#';
    modalAudio.src = track.audio;
    modalAudio.setAttribute('controls', true);
    modalAudio.setAttribute('preload', 'auto');
    modalAudio.load();
    modalAttribution.textContent = `Please credit the artist as: "${track.artist_name}" when you use this track.`;
    modalDownloadBtn.onclick = () => {
      window.open(track.audio_download || track.audio, '_blank');
    };
    trackModal.classList.add('active');
    trackModal.focus();
  }

  function secondsToTime(sec) {
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return `${m}:${s.toString().padStart(2,'0')}`;
  }

  function closeTrackModal() {
    trackModal.classList.remove('active');
    modalAudio.pause();
    modalAudio.src = '';
  }

  modalCloseBtn.addEventListener('click', closeTrackModal);
  trackModal.addEventListener('click', e => {
    if(e.target === trackModal) closeTrackModal();
  });
  window.addEventListener('keydown', e => {
    if(e.key === 'Escape' && trackModal.classList.contains('active')) closeTrackModal();
  });

  // --- Search page ---
  function renderSearch() {
    setActiveNav('nav-search');
    mainContent.innerHTML = `
      <h2>Search Music Tracks</h2>
      <form id="search-form" aria-label="Search music tracks">
        <input type="text" id="search-input" placeholder="Search artist, track or tag" aria-label="Search input" required />
        <select id="genre-select" aria-label="Select genre">
          <option value="">All Genres</option>
          <option value="pop">Pop</option>
          <option value="rock">Rock</option>
          <option value="rap">Rap</option>
          <option value="electronic">Electronic</option>
          <option value="jazz">Jazz</option>
          <option value="blues">Blues</option>
          <option value="classical">Classical</option>
          <option value="folk">Folk</option>
          <option value="country">Country</option>
          <option value="reggae">Reggae</option>
          <option value="metal">Metal</option>
        </select>
        <select id="country-select" aria-label="Select country">
          <option value="">All Countries</option>
          <option value="morocco">Morocco</option>
          <option value="mena">MENA</option>
          <option value="europe">Europe</option>
          <option value="us">United States</option>
        </select>
        <button type="submit">Search</button>
      </form>
      <div id="search-results" class="track-list" tabindex="0" aria-live="polite"></div>
    `;
    mainContent.focus();

    const form = document.getElementById('search-form');
    form.addEventListener('submit', e => {
      e.preventDefault();
      performSearch();
    });
  }

  async function performSearch() {
    const query = document.getElementById('search-input').value.trim();
    const genre = document.getElementById('genre-select').value;
    const country = document.getElementById('country-select').value;
    const resultsContainer = document.getElementById('search-results');
    resultsContainer.innerHTML = '<p>Loading results...</p>';

    if (!query) {
      resultsContainer.innerHTML = '<p>Please enter a search term.</p>';
      return;
    }

    try {
      // Compose API call with filters
      let url = `https://api.jamendo.com/v3.0/tracks/?client_id=${CLIENT_ID}&format=jsonpretty&limit=20&include=musicinfo+stats+license&search=${encodeURIComponent(query)}`;
      if(genre) url += `&tags=${encodeURIComponent(genre)}`;
      // Note: Jamendo API doesn't have country filter on tracks directly; this is a placeholder if you implement elsewhere.
      const res = await fetch(url);
      const data = await res.json();
      if(data.results.length === 0) {
        resultsContainer.innerHTML = '<p>No tracks found.</p>';
        return;
      }
      resultsContainer.innerHTML = '';
      data.results.forEach(track => {
        const tile = createTrackTile(track);
        resultsContainer.appendChild(tile);
      });
    } catch(err) {
      resultsContainer.innerHTML = '<p>Error fetching results. Try again later.</p>';
      console.error(err);
    }
  }

  // --- Favorites page ---
  function renderFavorites() {
    setActiveNav('nav-favorites');
    mainContent.innerHTML = '<h2>Your Favorite Tracks</h2>';
    const favs = getFavorites();
    if(favs.length === 0) {
      mainContent.innerHTML += '<p class="empty-msg">No favorite tracks yet.</p>';
      return;
    }
    const favContainer = document.createElement('div');
    favContainer.className = 'track-list';
    favs.forEach(track => {
      const tile = createTrackTile(track);
      favContainer.appendChild(tile);
    });
    mainContent.appendChild(favContainer);
    mainContent.focus();
  }

  // --- About page ---
  function renderAbout() {
    setActiveNav('nav-about');
    mainContent.innerHTML = `
      <h2>About Music With Vibe</h2>
      <p>Music With Vibe is a free platform showcasing legally free-to-download music tracks licensed under Creative Commons, Public Domain, or directly from artists who allow free downloads.</p>
      <p>Our mission is to provide creators and music lovers a trusted place to discover, preview, and download quality free music while respecting licensing terms and artist rights.</p>
    `;
    mainContent.focus();
  }

  // --- Contact page ---
  function renderContact() {
    setActiveNav('nav-contact');
    mainContent.innerHTML = `
      <h2>Contact Us</h2>
      <p>If you have questions, feedback, or want to claim your music, reach out via:</p>
      <ul>
        <li>Email: <a href="mailto:mohamedamineelbachiri2005@gmail.com">mohamedamineelbachiri2005@gmail.com</a></li>
        <li>Instagram: <a href="https://www.instagram.com/p_______goodguy?igsh=MWFxY2kxNDlqd2R5Mg==" target="_blank" rel="noopener noreferrer">@p_______goodguy</a></li>
      </ul>
    `;
    mainContent.focus();
  }

  // Initial page load
  renderHome();

  // Navigation event listeners
  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const pageId = btn.id;
      switch(pageId) {
        case 'nav-home': renderHome(); break;
        case 'nav-search': renderSearch(); break;
        case 'nav-favorites': renderFavorites(); break;
        case 'nav-about': renderAbout(); break;
        case 'nav-contact': renderContact(); break;
      }
    });
  });

  // Keyboard navigation: focus main content on page change for accessibility
  mainContent.addEventListener('keydown', e => {
    if(e.key === 'Tab') {
      // Manage focus trapping in modal if open (not implemented fully here for brevity)
    }
  });
</script>

</body>
</html>
