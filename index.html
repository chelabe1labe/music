<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Music With Vibe - Legal Free Music Search & Download</title>

<!-- Favicon as inline SVG -->
<link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiByb2xlPSJpbWciIGFyaWEtbGFiZWw9ImZhdmNvbjEgbXVzaWMgd2l0aCB2aWJlIj4KICA8cGF0aCBkPSJNMTAgNDAgTDE4IDIwIDI0IDQwIDMyIDEwIDM4IDQwIDQ2IDMwIDU0IDQwIiBmaWxsPSJub25lIiBzdHJva2U9IiNCMzAwMDAiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgLz4KPC9zdmc+" type="image/svg+xml" />

<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

  body {
    margin: 0;
    background: #fff;
    color: #222;
    font-family: 'Poppins', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
    min-height: 100vh;
  }

  header {
    display: flex;
    align-items: center;
    gap: 12px;
    user-select: none;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  header svg {
    height: 36px;
    width: auto;
  }

  header h1 {
    font-weight: 700;
    font-size: 1.8rem;
    color: #B30000;
    margin: 0;
    white-space: nowrap;
  }

  form#searchForm {
    width: 100%;
    max-width: 680px;
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-bottom: 1rem;
    justify-content: center;
  }

  input[type="text"] {
    flex-grow: 2;
    padding: 12px 16px;
    border-radius: 30px;
    border: 2px solid #B30000;
    font-size: 1rem;
    outline-offset: 2px;
  }

  input[type="text"]:focus {
    border-color: #800000;
  }

  select {
    flex-grow: 1;
    min-width: 120px;
    padding: 12px 14px;
    border-radius: 30px;
    border: 2px solid #B30000;
    font-size: 1rem;
    outline-offset: 2px;
    appearance: none;
    background: white url('data:image/svg+xml;charset=US-ASCII,<svg fill="%23B30000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 12px center/1em 1em;
    cursor: pointer;
  }

  button#searchBtn {
    background: #B30000;
    color: white;
    border: none;
    border-radius: 30px;
    padding: 12px 24px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
    flex-grow: 1;
    min-width: 140px;
  }

  button#searchBtn:hover {
    background: #800000;
  }

  .track-card {
    width: 100%;
    max-width: 680px;
    box-shadow: 0 4px 12px rgba(179, 0, 0, 0.15);
    border-radius: 12px;
    padding: 16px;
    box-sizing: border-box;
    margin-top: 1.5rem;
    text-align: center;
    user-select: none;
    position: relative;
    overflow: hidden;
  }

  .track-card:hover::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 120%;
    height: 120%;
    background: rgba(179, 0, 0, 0.1);
    border-radius: 50%;
    transform: translate(-50%, -50%) scale(1);
    animation: ripple 0.6s ease forwards;
    pointer-events: none;
    z-index: 0;
  }

  @keyframes ripple {
    from {
      transform: translate(-50%, -50%) scale(0);
      opacity: 0.5;
    }
    to {
      transform: translate(-50%, -50%) scale(1);
      opacity: 0;
    }
  }

  .track-card img {
    max-width: 100%;
    border-radius: 12px;
    margin-bottom: 1rem;
    display: none;
  }

  .track-info {
    font-size: 1.1rem;
    margin-bottom: 1rem;
    color: #444;
    min-height: 3rem;
  }

  audio#audioPlayer {
    width: 100%;
    border-radius: 8px;
    display: none;
    margin-bottom: 0.75rem;
    outline-offset: 2px;
  }

  canvas#waveform {
    width: 100%;
    height: 60px;
    border-radius: 8px;
    background: #f7f7f7;
    margin-bottom: 1rem;
    display: none;
  }

  a#downloadBtn {
    background: #B30000;
    color: white;
    padding: 12px 24px;
    border-radius: 30px;
    text-decoration: none;
    font-weight: 600;
    display: inline-block;
    user-select: none;
    transition: background 0.3s ease, width 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  a#downloadBtn.morphing {
    width: 48px;
    padding: 12px 0;
    border-radius: 50%;
    pointer-events: none;
  }

  a#downloadBtn:hover:not(.morphing) {
    background: #800000;
  }

  a#downloadBtn svg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    stroke: white;
    stroke-width: 3;
    fill: none;
    display: none;
  }

  a#downloadBtn.morphing svg {
    display: block;
  }

  footer {
    margin-top: 3rem;
    font-size: 0.9rem;
    color: #666;
    padding: 1rem;
    text-align: center;
    max-width: 680px;
    user-select: none;
  }

  footer a {
    color: #B30000;
    text-decoration: none;
  }

  footer a:hover {
    text-decoration: underline;
  }
</style>
</head>
<body>

<header>
  <svg width="120" height="36" viewBox="0 0 320 60" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="music with vibe logo" focusable="false" >
    <path d="M10 40 L18 20 L24 40 L32 10 L38 40 L46 30 L54 40" fill="none" stroke="#B30000" stroke-width="4" stroke-linejoin="round" />
    <text x="70" y="42" font-family="Poppins, sans-serif" font-weight="700" font-size="32" fill="#B30000" letter-spacing="2">music with vibe</text>
  </svg>
  <h1>Your music, your vibe</h1>
</header>

<form id="searchForm" aria-label="Music search form">
  <input type="text" id="searchInput" placeholder="Search for artist, track, or genre..." aria-label="Search music tracks" autocomplete="off" />

  <select id="genreSelect" aria-label="Select music genre">
    <option value="">All Genres</option>
    <option>Pop</option>
    <option>Rap</option>
    <option>Rock</option>
    <option>Jazz</option>
    <option>Electronic</option>
    <option>Classical</option>
    <option>Blues</option>
    <option>Reggae</option>
    <option>Country</option>
    <option>Folk</option>
    <option>Hip Hop</option>
    <option>Metal</option>
    <option>Dance</option>
    <option>R&B</option>
    <option>Soul</option>
    <option>World</option>
  </select>

  <select id="countrySelect" aria-label="Select artist country/region">
    <option value="">All Countries</option>
    <option value="Morocco">Morocco</option>
    <option value="MENA">MENA (Middle East & North Africa)</option>
    <option value="Europe">Europe</option>
    <option value="US">United States</option>
  </select>

  <select id="artistSelect" aria-label="Select artist">
    <option value="">All Artists</option>
    <!-- Moroccan Artists -->
    <option>Saad Lamjarred</option>
    <option>Douzi</option>
    <option>Hatim Ammor</option>
    <option>Ahmed Chawki</option>
    <option>Manal</option>
    <option>Fnaire</option>
    <option>Muslim</option>
    <option>Zouhair Bahaoui</option>
    <option>Issam Kamal</option>
    <option>Asmaa Lamnawar</option>
    <option>Rachid Kasmi</option>
    <option>Saida Fikri</option>
    <option>Oum</option>
    <option>Dounia Batma</option>
    <option>Abdelwahab Doukkali</option>
    <option>ElGrandeToto</option>
    <option>Kira7</option>
    <option>Bo9al</option>
    <option>Furelise</option>
    <option>7-Toun</option>
    <option>7liwa</option>

    <!-- MENA Artists -->
    <option>Mohamed Ramadan</option>
    <option>Amr Diab</option>
    <option>Nancy Ajram</option>
    <option>Elissa</option>
    <option>Cheb Khaled</option>

    <!-- European Artists -->
    <option>Adele</option>
    <option>Ed Sheeran</option>
    <option>DJ Snake</option>
    <option>David Guetta</option>
    <option>Calvin Harris</option>

    <!-- US Artists -->
    <option>Drake</option>
    <option>Kendrick Lamar</option>
    <option>Billie Eilish</option>
    <option>Post Malone</option>
    <option>Beyonc√©</option>
  </select>

  <button type="submit" id="searchBtn">Search</button>
</form>

<div class="track-card" aria-live="polite" aria-atomic="true" tabindex="0">
  <img id="image" src="" alt="" />
  <p class="track-info"></p>
  <audio id="audioPlayer" controls></audio>
  <canvas id="waveform"></canvas>
  <a id="downloadBtn" href="#" download aria-label="Download track (Free and Legal)">
    Download (Free & Legal)
    <svg width="36" height="36" viewBox="0 0 36 36">
      <circle cx="18" cy="18" r="15" stroke="#fff" stroke-width="3" stroke-dasharray="94.2" stroke-dashoffset="94.2" />
    </svg>
  </a>
</div>

<footer>
  <p>
    All downloadable content on Music With Vibe is free to download and use according to its listed license. If you believe a track is incorrectly labeled, please report it.
  </p>
  <p>Contact me: <a href="mailto:mohamedamineelbachiri2005@gmail.com">mohamedamineelbachiri2005@gmail.com</a></p>
  <p>Instagram: <a href="https://www.instagram.com/p_______goodguy?igsh=MWFxY2kxNDlqd2R5Mg==" target="_blank" rel="noopener noreferrer">@p_______goodguy</a></p>
</footer>

<script>
  // === Replace with your Jamendo API client ID ===
  const CLIENT_ID = 'YOUR_JAMENDO_CLIENT_ID';

  const form = document.getElementById('searchForm');
  const input = document.getElementById('searchInput');
  const genreSelect = document.getElementById('genreSelect');
  const countrySelect = document.getElementById('countrySelect');
  const artistSelect = document.getElementById('artistSelect');

  const image = document.getElementById('image');
  const trackInfo = document.querySelector('.track-info');
  const audioPlayer = document.getElementById('audioPlayer');
  const downloadBtn = document.getElementById('downloadBtn');
  const waveformCanvas = document.getElementById('waveform');
  const ctx = waveformCanvas.getContext('2d');

  let animationId = null;
  let audioContext;
  let analyser;
  let source;
  let dataArray;
  let bufferLength;

  function clearUI() {
    image.style.display = 'none';
    image.src = '';
    image.alt = '';
    trackInfo.textContent = '';
    audioPlayer.style.display = 'none';
    audioPlayer.pause();
    audioPlayer.src = '';
    downloadBtn.style.display = 'none';
    downloadBtn.href = '#';
    stopWaveform();
    waveformCanvas.style.display = 'none';
    resetDownloadButton();
  }

  function resetDownloadButton() {
    downloadBtn.classList.remove('morphing');
    const circle = downloadBtn.querySelector('circle');
    if(circle) {
      circle.style.strokeDashoffset = '94.2';
    }
    downloadBtn.textContent = 'Download (Free & Legal)';
  }

  function showTrack(track) {
    image.src = track.album_image;
    image.alt = `${track.name} album art`;
    image.style.display = 'block';

    const licenseText = track.license_ccurl ? 
      `<a href="${track.license_ccurl}" target="_blank" rel="noopener noreferrer">License info</a>` : 'License info unavailable';

    trackInfo.innerHTML = `
      <strong>${track.name}</strong> by <em>${track.artist_name}</em><br/>
      ${licenseText}
    `;

    audioPlayer.src = track.audio;
    audioPlayer.style.display = 'block';

    downloadBtn.href = track.audio;
    downloadBtn.style.display = 'inline-block';

    waveformCanvas.style.display = 'block';
  }

  async function searchTracks(query, genre, country, artist) {
    clearUI();

    if (!query) {
      alert('Please enter a search term.');
      return;
    }

    try {
      let apiUrl = `https://api.jamendo.com/v3.0/tracks/?client_id=${CLIENT_ID}&format=json&limit=20&fuzzytags=true`;

      if (query) {
        apiUrl += `&namesearch=${encodeURIComponent(query)}`;
      }
      if (genre) {
        apiUrl += `&tags=${encodeURIComponent(genre.toLowerCase())}`;
      }

      const response = await fetch(apiUrl);
      const data = await response.json();

      if (data.results && data.results.length > 0) {
        let filtered = data.results;

        if (country) {
          const countryLower = country.toLowerCase();
          filtered = filtered.filter(track => {
            const artistName = track.artist_name.toLowerCase();
            if (countryLower === 'morocco') {
              const moroccanArtists = [
                'saad lamjarred', 'douzi', 'hatim ammor', 'ahmed chawki', 'manal', 'fnaire', 'muslim',
                'zouhair bahaoui', 'issam kamal', 'asmaa lamnawar', 'rachid kasmi', 'saida fikri', 'oum',
                'dounia batma', 'abdelwahab doukkali', 'elgrandetoto', 'kira7', 'bo9al', 'furelise', '7-toun', '7liwa'
              ];
              return moroccanArtists.some(name => artistName.includes(name));
            }
            if (countryLower === 'mena') {
              return artistName.includes('ramadan') || artistName.includes('mena') || artistName.includes('arab');
            }
            if (countryLower === 'europe') {
              return artistName.includes('adele') || artistName.includes('dj') || artistName.includes('ed sheeran') || artistName.includes('europe');
            }
            if (countryLower === 'us') {
              return artistName.includes('drake') || artistName.includes('kendrick') || artistName.includes('rap') || artistName.includes('hip hop') || artistName.includes('us');
            }
            return true;
          });
        }

        if (artist) {
          const artistLower = artist.toLowerCase();
          filtered = filtered.filter(track => track.artist_name.toLowerCase().includes(artistLower));
        }

        if (filtered.length === 0) {
          alert('No tracks found with those filters.');
          return;
        }

        showTrack(filtered[0]); // show first result

        // Setup audio context and waveform
        setupAudioWaveform();

        // Setup download button animation on click
        downloadBtn.onclick = (e) => {
          e.preventDefault();
          downloadTrack(filtered[0]);
        };

        // Play audio on load
        audioPlayer.play();

      } else {
        alert('No tracks found. Try different keywords.');
      }
    } catch (error) {
      console.error('Error fetching tracks:', error);
      alert('Error fetching music tracks. Please try again later.');
    }
  }

  function setupAudioWaveform() {
    if (audioContext) {
      audioContext.close();
      cancelAnimationFrame(animationId);
    }

    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioContext.createAnalyser();
    source = audioContext.createMediaElementSource(audioPlayer);
    source.connect(analyser);
    analyser.connect(audioContext.destination);

    analyser.fftSize = 256;
    bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);

    drawWaveform();
  }

  function drawWaveform() {
    animationId = requestAnimationFrame(drawWaveform);
    analyser.getByteFrequencyData(dataArray);

    const width = waveformCanvas.width = waveformCanvas.clientWidth;
    const height = waveformCanvas.height = waveformCanvas.clientHeight;

    ctx.clearRect(0, 0, width, height);
    const barWidth = (width / bufferLength) * 2.5;
    let barHeight;
    let x = 0;

    for(let i = 0; i < bufferLength; i++) {
      barHeight = dataArray[i]/2;
      ctx.fillStyle = '#B30000';
      ctx.fillRect(x, height - barHeight, barWidth, barHeight);
      x += barWidth + 1;
    }
  }

  function stopWaveform() {
    if(animationId) {
      cancelAnimationFrame(animationId);
    }
    if(audioContext) {
      audioContext.close();
    }
  }

  // Download animation & flow
  function downloadTrack(track) {
    // Morph button animation
    downloadBtn.classList.add('morphing');
    downloadBtn.textContent = '';
    
    const circle = downloadBtn.querySelector('circle');
    let offset = 94.2;
    let progress = 0;
    const speed = 2.5;

    function animateProgress() {
      if(progress >= 100) {
        downloadBtn.classList.remove('morphing');
        downloadBtn.textContent = 'Download (Free & Legal)';
        window.open(track.audio, '_blank');
        return;
      }
      offset = 94.2 - (94.2 * (progress / 100));
      circle.style.strokeDashoffset = offset;
      progress += speed;
      requestAnimationFrame(animateProgress);
    }
    animateProgress();
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const query = input.value.trim();
    const genre = genreSelect.value;
    const country = countrySelect.value;
    const artist = artistSelect.value;

    searchTracks(query, genre, country, artist);
  });
</script>

</body>
</html>
